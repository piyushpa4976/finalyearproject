<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS || Reset Pasword</title>
    <link rel="stylesheet" href="plugins/bootstrap-4.0.0-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/bootstrap-4.0.0-dist/css/bootstrap-grid.min.css">
    <!-- <link rel="stylesheet" href="plugins/bootstrap-3.3.7-dist/css/bootstrap.min.css"> -->
    <!-- <link rel="stylesheet" href="plugins/jquery-ui-1.12.1/jquery-ui.min.css"> -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"> -->
    <!-- <link rel="stylesheet" href="registrationstyle.css"> -->
    <link rel="stylesheet" href="index.css">
    <!-- <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.0/css/all.css" integrity="sha384-Mmxa0mLqhmOeaE8vgOSbKacftZcsNYDjQzuCOm6D02luYSzBG8vpaOykv9lFQ51Y" crossorigin="anonymous">


</head>

<body>

    <div class="" id="">
        <div class="modal-dialog">
            <form id="resetpasswordform">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Reset Password</h4>


                    </div>
                    <div class="modal-body">

                        <div class="row">

                            <div class="col-md-12">
                                <label class="col-md-6 control-label">Enter New Password</label>
                                <div class="col-md-6"><input type="text" class="form-control input-sm pristine untouched valid empty" id="student_newpassword" name="user_password" placeholder="" style="padding:5px;margin-bottom: 10px;"></div>
                            </div>

                            <div class="col-md-12" show="u!=&#39;up&#39;">
                                <label class="col-md-6 control-label">Confirm Password</label>
                                <div class="col-md-6"><input type="text" class="form-control input-sm pristine valid empty touched" id="student_newconfirmpassword" name="user_newconfirmpassword" style="padding:5px;margin-bottom: 10px;"></div>
                            </div>

                            ,ṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁṁ
                        </div>

                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" onclick="close();" class="btn btn-default">Close</button>
                        <button type="button" class="btn btn-primary" id="newpasswordbtn">Reset Password</button>
                    </div>
                    <div class="alert alert-success" id="loginon_success" style="display:none">
                        <strong>Success!</strong> Password Reset successfully.. Redirecting to Homepage.
                    </div>
                    <div class="alert alert-warning" id="loginon_error" style="display:none">
                        <strong>Warning!</strong> <span id="loginon_errorwarn"></span>
                    </div>
                </div>
            </form>

            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</body>
<script src="plugins/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<script src="plugins/bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
<script src="plugins/Jquery.serializejson/jquery.serializejson.min.js"></script>
<script src="plugins/popper/popper.min.js"></script>
<script src="plugins/jquery-validation-1.19.2/jquery.validate.min.js"></script>
<script src="plugins/jquery-validation-1.19.2/additional-methods.min.js"></script>

<script>
    $(document).ready(function() {
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };
        var student_email = getUrlParameter('user_email');
        var token = getUrlParameter('resetpasswordtoken')


        $('#newpasswordbtn').on('click', function() {

            if ($('#student_newpassword').val() != '' && $('#student_newconfirmpassword').val() != '') {
                var rfd = $('#resetpasswordform').serializeJSON();

                console.log(JSON.stringify(rfd))
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/user/passwordreset?resetpasswordtoken=" + getUrlParameter('resetpasswordtoken') + "&user_email=" + getUrlParameter('student_email'),
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(rfd),
                    dataType: "text",
                    success: function(data) {
                        console.log("success");
                        console.log(data);

                        $("#loginon_success").css("display", "block");

                        setTimeout(function() {

                            location.href = "index.html";
                            $("#loginon_success").css("display", "none");

                        }, 5000);
                        // if (data.status_code == 200) {

                        // } else {
                        //     console.log("");
                        //     $("#loginon_error").css("display", "block");
                        //     $('#loginon_errorwarn').text(data.message);
                        //     setTimeout(function() {
                        //         $("#loginon_error").css("display", "none");
                        //     }, 5000);
                        // }

                    },
                    error: function(errMsg) {
                        console.log("error");
                        $("#loginon_error").css("display", "block");
                        $('#loginon_errorwarn').text("Error in Server Connection");
                        console.log(errMsg);


                        setTimeout(function() {
                            $("#loginon_error").css("display", "none");
                        }, 5000);

                    }
                });

            }
        })
    })
</script>

</html>